---
categories: ASP.net
---

# Cross Site Request Forgery -CSRF

跨站请求伪造

恶意网站使用JS脚本自动提交表单,利用了你自己的Cookie.

## 如何防止

1.  在控制器方法中使用反伪造令牌.(Cookie和表单令牌的组合)

    ```C#
    [HttpPost]
    [Authorize("NotAuthenticated")]

    //在Post请求中使用反伪造令牌，GET方法没有意义 
    [ValidateAntiForgeryToken]
    public async Task<IActionResult> Register(RegisterDTO registerDTO)
    {
        //something
    }
    ```

    或者使用全局
    ```C#
    services.AddControllersWithViews(options =>
    {
        //还有一个没有Auto的方法,区别是它连GET也会使用反伪造令牌.
        options.Filters.Add(new AutoValidateAntiforgeryTokenAttribute());
    });
    ```

2.  使用标签助手
  
    `asp-controller` 等
    
    ```C#
    <form asp-controller="Account" asp-action="Register" method="post">
    ```
## 原理

表单也有表单令牌，别人的表单提交过来没用.